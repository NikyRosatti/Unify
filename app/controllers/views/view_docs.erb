<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="/view_docs.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <meta name="csrf-token" content="<%= csrf_token %>">
</head>
<body>
  <div id='container'></div>
  <nav class="navbar">
    <img src="media/logo.png" alt="Logo Unify" class="logo">
    <div class="search-container">
      <form action="/view_docs" method="post">
        <input type="text" name="search" placeholder="Search by name..." class="search-input">
        <select name="sort" class="sort-select">
          <option value="">Order by...</option>
          <option value="name">Name (A-Z)</option>
          <option value="recent">Latest</option>
          <option value="oldest">Oldest</option>
        </select>
        <button type="submit" class="search-button">Search</button>
      </form>
      <a href="/view_docs" class="clear-button">Clear All</a>
    </div>
    <div class="nav-icons">
        <a href="/favorites" class="icon-fav"><i class='bx bxs-bookmark-heart'></i></a>
        <a href="#settings" class="icon"><i class="fas fa-cog"></i></a>
        <a href="#account" class="icon"><i class="fas fa-user"></i></a>
    </div>
  </nav>
  <div class="hero">
    <div class="hero-title"><h1>Documentos Cargados</h1></div>
    <div class="documents-container">
      <% @documents.each do |document| %>
        <div class="document-card" id="document-<%= document.id %>">
          <!-- File es un metodo para poder obtener el nombre del documento sin la extension pdf -->
          <h3 class="document-title"><%= File.basename(document.filename, File.extname(document.filename)) %></h3>
          
          <div class="document-actions" id="actions-<%= document.id %>">
            <p>Fecha de carga: <%= document.uploaddate %></p>
            <!-- Documentos que puede eliminar el admin  -->
            <% if user.is_admin == 1%>
              <img src="media/trash.png" onclick="deleteDocument('<%= document.id %>')" id="delete-button" alt="delete" class="delete_doc">
            <% end %>
            <!-- Esto es para manejar el apartado de favoritos -->
            <% if user.favorite_documents.include?(document) %>
              <i class="fas fa-heart favorite-icon active" data-favorite="true" data-document-id="<%= document.id %>"></i>
            <% else %>
              <i class="far fa-heart favorite-icon" data-favorite="false" data-document-id="<%= document.id %>" ></i>
            <% end %>

            <a href="/documents/<%= document.id %>" class="btn-view">View Document</a>
            <a href="/documents/<%= document.id %>/practice_doc" class="btn-view">Practice</a>
            <a href="/documents/<%= document.id %>/statistics" class="btn-stats">View Statistics</a>
          </div>
        </div>
      <% end %>
    </div>
  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <script src="view_docs.js"></script>

  <script src="favorites.js"></script>

  <script>
    function toggleCard(element) {
      // Remueve la clase 'active' de todas las tarjetas
      document.querySelectorAll('.document-card').forEach(card => {
        card.classList.remove('active');
      });

      // Añade la clase 'active' solo a la tarjeta clicada
      element.classList.add('active');
    }

    function deleteDocument(documentId) {
      // Confirmación antes de eliminar (por las dudis)
      if (confirm("¿Estás seguro de que deseas eliminar este documento?")) {
        fetch(`/api/documents/${documentId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => {
          if (response.ok) {
            alert('Documento eliminado correctamente');
            //document.getElementById("delete-button").closest(".document-container").remove();
            location.reload();
          } else {
            return response.json().then(error => {
              alert('Error: ' + error.message);
            });
          }
        })
        .catch(error => {
          console.error('Error al eliminar el documento:', error);
        });
      }
    }

  </script>
</body>
</html>
